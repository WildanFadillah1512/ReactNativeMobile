// Mendefinisikan generator client. Ini memberitahu Prisma untuk
// menghasilkan Prisma Client berbasis JavaScript/TypeScript.
generator client {
  provider = "prisma-client-js"
}

// Mendefinisikan koneksi database Anda.
// Di sini Anda menggunakan PostgreSQL.
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// === ENUM & MODEL APLIKASI ===

// Enum untuk Role (Admin / Penyewa)
enum Role {
  PENYEWA
  ADMIN
}

// Model untuk Pengguna (Customer)
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String   // Disimpan dalam bentuk hash (hasil bcrypt)
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // --- RELASI YANG SUDAH ADA ---
  role      Role           @default(PENYEWA)
  saved     SavedProduct[]
  cart      CartItem[]
  addresses Address[]

  // --- TAMBAHAN UNTUK ULASAN ---
  reviews   Review[] // User ini bisa menulis banyak ulasan
}

// Model untuk Penjual (Seller/Toko)
model Seller {
  id          Int      @id // ID diisi manual, bukan auto-increment.
  name        String
  avatar      String?
  bio         String?
  rating      Float?
  itemsRented Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relasi: Satu Seller bisa memiliki BANYAK Produk
  products    Product[]
}

// Model untuk Produk
model Product {
  id          Int      @id @default(autoincrement())
  name        String
  price       Float
  description String
  imageUrl    String?
  category    String?
  
  // --- PERUBAHAN UNTUK ULASAN (RATING KUMULATIF) ---
  // rating      Float?   // HAPUS INI (dummy)
  // reviews     Int?     // HAPUS INI (dummy)
  
  ratingAvg   Float    @default(0) // Rating rata-rata (kumulatif)
  reviewsCount Int     @default(0) // Jumlah total ulasan
  // ------------------------------------------------

  trending    Boolean  @default(false)
  location    String?
  period      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relasi: Banyak Produk dimiliki oleh SATU Seller
  sellerId    Int
  seller      Seller   @relation(fields: [sellerId], references: [id], onDelete: Cascade)

  // --- RELASI YANG SUDAH ADA ---
  likedBy     SavedProduct[]
  inCart      CartItem[]
  
  // --- TAMBAHAN UNTUK ULASAN ---
  reviews     Review[] // Produk ini memiliki banyak ulasan
}


// --- MODEL UNTUK FITUR "LIKES" ---
model SavedProduct {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId Int
  @@unique([userId, productId]) 
}

// --- MODEL UNTUK FITUR "KERANJANG" ---
model CartItem {
  id        Int      @id @default(autoincrement())
  duration  Int      @default(1)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId Int
  @@unique([userId, productId])
}


// --- MODEL UNTUK FITUR "ALAMAT" ---
model Address {
  id           Int      @id @default(autoincrement())
  label        String
  receiverName String
  phone        String
  street       String
  city         String
  province     String
  postalCode   String
  isPrimary    Boolean  @default(false)
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId       Int
}


// --- MODEL BARU UNTUK FITUR "ULASAN" ---
model Review {
  id        Int      @id @default(autoincrement())
  rating    Int      // Rating 1-5 yang diberikan user
  comment   String?  // Teks ulasan
  createdAt DateTime @default(now())
  
  // Relasi: Ulasan ini ditulis oleh SATU User
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  
  // Relasi: Ulasan ini untuk SATU Product
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId Int

  // 1 user hanya bisa review 1 produk 1x
  @@unique([userId, productId])
}